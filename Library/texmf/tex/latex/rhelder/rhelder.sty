\NeedsTeXFormat{LaTeX2e}[2022/11/01]
\ProvidesPackage{rhelder}[2024/10/19 Russell Wright Helder's style file]

% Required packages {{{1

\RequirePackage{etoolbox}
\RequirePackage{fontspec}
\RequirePackage[shorthands=off, latin, greek.ancient, english.american]{babel}
\RequirePackage[
    autostyle,
    latin=britishquotes,
]{csquotes}
\RequirePackage[
    indentfirst=false,
    rightmargin=0in,
]{quoting}
\PassOptionsToPackage{hyphens}{url}
\AtEndOfPackage{\RequirePackage{hyperref}}
\RequirePackage{enumitem}
\RequirePackage{pifont}
\RequirePackage{array}
\RequirePackage{booktabs}
\RequirePackage{ragged2e}
\RequirePackage[babel]{microtype}
\RequirePackage[chicago]{xellipsis}
\RequirePackage[shortcuts]{extdash}
\RequirePackage{iftex}
\RequirePackage{geometry}

% Options {{{1

% Declare options {{{2

\DeclareOption{biblatex}{\booltrue{@biblatex}}
\DeclareOption{nomencl}{\booltrue{@nomencl}}
\DeclareOption{doublespaced}{\booltrue{@doublespaced}}
\DeclareOption{anonymous}{\boolfalse{@author}\booltrue{@anonymous}}
\DeclareOption{misguided}{\booltrue{@misguided}}
\DeclareOption{notranslit}{\boolfalse{@translit}}
\DeclareOption{nosecnum}{\setcounter{secnumdepth}{-\maxdimen}}

\DeclareOption*{\PackageWarning{rhelder}{Unknown ‘\CurrentOption’}}

% Declare bools {{{3

\newbool{@biblatex}
\newbool{@nomencl}
\newbool{@doublespaced}
\newbool{@author}
\newbool{@anonymous}
\newbool{@misguided}
\newbool{@translit}

\booltrue{@author}
\booltrue{@translit}

% }}}3

% Execute options {{{2

\ProcessOptions\relax

% biblatex {{{3

\if@biblatex
    \RequirePackage[
        authordate,
        isbn=false,
        url=false,
        doi=false,
        compresspages=true,
        dashed=false,
        citereset=section,
        pagetracker=false,
        cmslos=false,
        autolang=hyphen,
    ]{biblatex-chicago}%
    \addbibresource{my_library.bib}

    % Map `cms-american.lbx` onto polyglossia language `latin'; replaces dummy
    % `latin.lbx`
    \DeclareLanguageMapping{latin}{cms-american}

    % Patch `\footnotetext` so that the footnote-specific `ibidtracker` resets
    % at the beginning of each footnote
    \NewCommandCopy{\oldfootnotetext}{\footnotetext}
    \RenewDocumentCommand{\footnotetext}{+m}{\oldfootnotetext{\mancite #1}}
\fi

% nomencl {{{3

\if@nomencl
    \RequirePackage{nomencl}
    \makenomenclature
    \renewcommand{\nomname}{Abbreviations}

    % No inter-sentence spacing in nomenclatures (as in biblatex citations)
    \NewCommandCopy{\defprintnomenclature}{\printnomenclature}
    \RenewDocumentCommand{\printnomenclature}{}{%
        \frenchspacing
        \defprintnomenclature
        \nonfrenchspacing
    }

    \if@biblatex
        % Ensure uniformity with bibliography spacing
        \setlength{\nomitemsep}{\bibitemsep}
        \addtolength{\nomitemsep}{-\parsep} % Remove excess spacing
    \else
        \addtolength{\nomitemsep}{-\parsep} % Remove excess spacing
    \fi
\fi

% doublespaced {{{3

\if@doublespaced
    \RequirePackage{setspace}
    \doublespacing

    \if@biblatex
        \if@nomencl
            \setlength{\bibitemsep}{0pt}        % Remove excess spacing
            \addtolength{\nomitemsep}{-\parsep} % Remove excess spacing
        \else
            \setlength{\bibitemsep}{0pt}        % Remove excess spacing
        \fi
    \fi
\fi

% author {{{3
\if@author
    \AtEndOfPackage{
        \author{Russell\ Wright\ Helder}
        \hypersetup{pdfauthor={Russell\ Wright\ Helder}}
    }
\fi

% anonymous {{{3
\if@anonymous
    \RenewDocumentCommand{\@maketitle}{}{%
        \newpage
        \null
        \vskip 2em%
        \begin{center}%
            \let \footnote \thanks
            {\LARGE \@title \par}%
            \vskip 1.5em%
            {\large \@date}%
        \end{center}%
        \par
        \vskip 1.5em%
    }
\fi

% misguided {{{3

\if@misguided
    % Include punctuation within quotes
    \DeclareAutoPunct{.,}
    \renewcommand{\mktextquote}[6]{#1#2#4#5#3#6}

\else
    % Use British quotation conventions when language is american english
    % Use single quotes outside, double quotes inside
    \DeclareQuoteStyle[american]{english}
        {\textquoteleft}{\textquoteright}
        {\textquotedblleft}{\textquotedblright}

    % Place punctuation outside quotes in bibliographies
    \if@biblatex
        \DefineBibliographyExtras{american}{\stdpunctuation}
    \fi
\fi

% }}}3

% }}}2

% General {{{1

\babeltags{greek = greek} % for backwards compatibility
\babelprovide[hyphenrules=classiclatin]{latin}

\setmainfont{Brill}

\if@twocolumn
    \geometry{hscale=0.7635}
\else
    \ifLuaTeX
        \geometry{hscale=\directlua{tex.print(0.03680 * \f@size + 0.1936)}}
    \else
        \geometry{pass}
    \fi
\fi

\clubpenalty=10000
\widowpenalty=10000

\hyphenation{Prem-ise Prem-ises}

\AtEndOfPackage{%
    \hypersetup{
        colorlinks=true,
        linkcolor=black,
        filecolor=magenta,
        citecolor=black,
        urlcolor=blue,
        pdfpagemode=UseNone,
    }%
    \AtBeginDocument{%
        \hypersetup{pdftitle={\@title}}
    }%
    \urlstyle{same}%
}

% Quotations {{{1

% Set quoting environment as default block quote environment for `csquotes`
\SetBlockEnvironment{quoting}

% Replace `quotation` environment (which is used for abstracts) with `quoting`
% environment
\renewenvironment{quotation}{\begin{quoting}}{\end{quoting}}

% Achieve desired spacing for syllogisms in block quotes
\renewcommand*{\quotingfont}{\small\setlength{\itemsep}{0pt}}

% Use double quotes when language is ancient Greek
\DeclareQuoteStyle[ancient]{greek}
    {\textquotedblleft}{\textquotedblright}
    {\textquoteleft}{\textquoteright}
\DeclareQuoteAlias[ancient]{greek}{greek}

% Lists {{{1

% Change default bullet points for nested itemized lists
\setlist[itemize,2]{label=\ding{118}}
\setlist[itemize,3]{label=\ding{66}}

% Define `outline` list
\newlist{outline}{enumerate}{5}
\setlist[outline,1]{label=\Roman*.}
\setlist[outline,2]{label=\Alph*.}
\setlist[outline,3]{label=\arabic*.}
\setlist[outline,4]{label=\alph*.}
\setlist[outline,5]{label=\roman*.}

% Make paragraph spacing within list same as outside of list
\setlist[1,2,3,4,5]{listparindent=1\parindent, parsep=0pt}

\newlist{enumerate*}{enumerate*}{1}
\setlist[enumerate*]{label=\Alph*.}

% A potentially useful configuration for description
% \setlist[description]{%
%      style=nextline,
%      leftmargin=0em,
%      itemindent=!,
%      itemsep=2\itemsep,
% }

% Custom commands {{{1

% Define copy of `\emph` so that, even if `\emph` is redefined, the following
% commands italicize their arguments
\NewCommandCopy{\emphit}{\emph}

\NewDocumentCommand{\texttitle}{m}{\emphit{#1}}
\NewDocumentCommand{\alialingua}{O{}O{latin}m}{%
    \textlang[#1]{#2}{\emphit{#3}}%
}
\NewCommandCopy{\define}{\emphit}
\NewCommandCopy{\attn}{\textbf}

\if@translit
    \NewDocumentCommand{\boulesis}{}{\alialingua{boulēsis}}
    \NewDocumentCommand{\Boulesis}{}{\alialingua{Boulēsis}}
    \NewDocumentCommand{\bouleseis}{}{\alialingua{boulēseis}}
    \NewDocumentCommand{\Bouleseis}{}{\alialingua{Boulēseis}}
    \NewDocumentCommand{\nous}{}{\alialingua{nous}}
    \NewDocumentCommand{\Nous}{}{\alialingua{Nous}}
    \NewDocumentCommand{\phantasiai}{}{\alialingua{phantasiai}}
    \NewDocumentCommand{\Phantasiai}{}{\alialingua{Phantasiai}}
    \NewDocumentCommand{\phantasia}{}{\alialingua{phantasia}}
    \NewDocumentCommand{\Phantasia}{}{\alialingua{Phantasia}}
    \NewDocumentCommand{\phantasmata}{}{\alialingua{phantasmata}}
    \NewDocumentCommand{\Phantasmata}{}{\alialingua{Phantasmata}}
    \NewDocumentCommand{\phantasma}{}{\alialingua{phantasma}}
    \NewDocumentCommand{\Phantasma}{}{\alialingua{Phantasma}}
    \NewDocumentCommand{\phronesis}{}{\alialingua{phronēsis}}
    \NewDocumentCommand{\Phronesis}{}{\alialingua{Phronēsis}}
    \NewDocumentCommand{\thumos}{}{\alialingua{thumos}}
    \NewDocumentCommand{\Thumos}{}{\alialingua{Thumos}}
\else
    \NewDocumentCommand{\boulesis}{}{\textgreek{βούλησις}}
    \NewDocumentCommand{\Boulesis}{}{\textgreek{Βούλησις}}
    \NewDocumentCommand{\bouleseis}{}{\textgreek{βουλήσεις}}
    \NewDocumentCommand{\Bouleseis}{}{\textgreek{Βουλήσεις}}
    \NewDocumentCommand{\nous}{}{\textgreek{νοῦς}}
    \NewDocumentCommand{\Nous}{}{\textgreek{Νοῦς}}
    \NewDocumentCommand{\phantasiai}{}{\textgreek{φαντασίαι}}
    \NewDocumentCommand{\Phantasiai}{}{\textgreek{Φαντασίαι}}
    \NewDocumentCommand{\phantasia}{}{\textgreek{φαντασία}}
    \NewDocumentCommand{\Phantasia}{}{\textgreek{Φαντασία}}
    \NewDocumentCommand{\phantasmata}{}{\textgreek{φαντάσματα}}
    \NewDocumentCommand{\Phantasmata}{}{\textgreek{Φαντάσματα}}
    \NewDocumentCommand{\phantasma}{}{\textgreek{φάντασμα}}
    \NewDocumentCommand{\Phantasma}{}{\textgreek{Φάντασμα}}
    \NewDocumentCommand{\phronesis}{}{\textgreek{φρόνησις}}
    \NewDocumentCommand{\Phronesis}{}{\textgreek{Φρόνησις}}
    \NewDocumentCommand{\thumos}{}{\textgreek{θυμός}}
    \NewDocumentCommand{\Thumos}{}{\textgreek{Θυμός}}
\fi

\NewDocumentCommand{\akrates}{}{\textgreek{ἀκρατής}}
\NewDocumentCommand{\Akrates}{}{\textgreek{Ἀκρατής}}
\NewDocumentCommand{\Deinos}{}{\textgreek{Δεινός}}
\NewDocumentCommand{\deinos}{}{\textgreek{δεινός}}
\NewDocumentCommand{\Deinotes}{}{\textgreek{Δεινότης}}
\NewDocumentCommand{\deinotes}{}{\textgreek{δεινότης}}
\NewDocumentCommand{\enkrates}{}{\textgreek{ἐγκρατής}}
\NewDocumentCommand{\Enkrates}{}{\textgreek{Ἐγκρατής}}
\NewDocumentCommand{\epithumia}{}{\textgreek{ἐπιθυμία}}
\NewDocumentCommand{\Epithumia}{}{\textgreek{Ἐπιθυμία}}
\NewDocumentCommand{\ergon}{}{\textgreek{ἔργον}}
\NewDocumentCommand{\Ergon}{}{\textgreek{Ἔργον}}
\NewDocumentCommand{\Euboulia}{}{\textgreek{Εὐβουλία}}
\NewDocumentCommand{\euboulia}{}{\textgreek{εὐβουλία}}
\NewDocumentCommand{\Krisis}{}{\textgreek{Κρίσις}}
\NewDocumentCommand{\krisis}{}{\textgreek{κρίσις}}
\NewDocumentCommand{\Logoi}{}{\textgreek{Λόγοι}}
\NewDocumentCommand{\logoi}{}{\textgreek{λόγοι}}
\NewDocumentCommand{\Logos}{}{\textgreek{Λόγος}}
\NewDocumentCommand{\logos}{}{\textgreek{λόγος}}
\NewDocumentCommand{\orexis}{}{\textgreek{ὄρεξις}}
\NewDocumentCommand{\Orexis}{}{\textgreek{Ὄρεξις}}
\NewDocumentCommand{\Pathemata}{}{\textgreek{Παθήματα}}
\NewDocumentCommand{\pathemata}{}{\textgreek{παθήματα}}
\NewDocumentCommand{\Phronime}{}{\textgreek{Φρονίμη}}
\NewDocumentCommand{\phronime}{}{\textgreek{φρονίμη}}
\NewDocumentCommand{\Phronimoi}{}{\textgreek{Φρόνιμοι}}
\NewDocumentCommand{\phronimoi}{}{\textgreek{φρόνιμοι}}
\NewDocumentCommand{\Phronimos}{}{\textgreek{Φρόνιμος}}
\NewDocumentCommand{\phronimos}{}{\textgreek{φρόνιμος}}
\NewDocumentCommand{\Prohaireseis}{}{\textgreek{Προαιρέσεις}}
\NewDocumentCommand{\prohaireseis}{}{\textgreek{προαιρέσεις}}
\NewDocumentCommand{\Prohairesis}{}{\textgreek{Προαίρεσις}}
\NewDocumentCommand{\prohairesis}{}{\textgreek{προαίρεσις}}

\NewDocumentCommand{\doxastikon}{s}{%
    \textgreek{\IfBooleanT{#1}{τὸ }δοξαστικόν}%
}
\NewDocumentCommand{\Doxastikon}{s}{%
    \IfBooleanTF{#1}{%
        \textgreek{Τὸ δοξαστικόν}%
    }{%
        \textgreek{Δοξαστικόν}%
    }%
}
\NewDocumentCommand{\ToDoxastikon}{}{\textgreek{Τὸ Δοξαστικόν}}

\NewDocumentCommand{\kalon}{s}{%
    \textgreek{\IfBooleanT{#1}{τὸ }καλόν}%
}
\NewDocumentCommand{\Kalon}{s}{%
    \IfBooleanTF{#1}{%
        \textgreek{Τὸ καλόν}%
    }{%
        \textgreek{Καλόν}%
    }%
}
\NewDocumentCommand{\ToKalon}{}{\textgreek{Τὸ Καλόν}}

\NewDocumentCommand{\logistikon}{s}{%
    \textgreek{\IfBooleanT{#1}{τὸ }λογιστικόν}%
}
\NewDocumentCommand{\Logistikon}{s}{%
    \IfBooleanTF{#1}{%
        \textgreek{Τὸ λογιστικόν}%
    }{%
        \textgreek{Λογιστικόν}%
    }%
}
\NewDocumentCommand{\ToLogistikon}{}{\textgreek{Τὸ Λογιστικόν}}

% }}}1
